# Machine Learning

Este diret√≥rio cont√©m os modelos da Fase 5:

1) **Classifica√ß√£o do estado da pe√ßa** (Saud√°vel / Desgastada / Cr√≠tica)  
2) **Previs√£o de falha em horizonte fixo** (por padr√£o, pr√≥ximas 24h)

Os modelos usam o dataset consolidado em `src/app/database/sensores.csv`.

---

## üì¶ Requisitos

```bash
python >= 3.9
pip install -r requirements.txt

### Conte√∫do sugerido de requirements.txt:
```bash
pandas
numpy
scikit-learn
matplotlib
joblib

Caso esteja em ambiente fechado (ex.: EC2), crie um venv:
python -m venv .venv && source .venv/bin/activate (Linux/Mac)
.\.venv\Scripts\activate (Windows)

machine_learning/
    classificar_estado_peca.py
    prever_falha_proximas_24h.py
    models/
        modelo_estado_peca.joblib
        modelo_falha_24h.joblib
    README.md   <- este arquivo
assets/
    matriz_confusao_estado.png
    feature_importance_estado.png
    matriz_confusao_falha_24h.png
    roc_falha_24h.png

## üß† Modelos
1) Classifica√ß√£o do estado da pe√ßa

Arquivo: classificar_estado_peca.py

Objetivo: classificar cada pe√ßa em Saud√°vel / Desgastada / Cr√≠tica
(mapeados do r√≥tulo risco_falha presente no CSV).

Entradas (features): tempo_uso, ciclos, temperatura, vibracao.

Modelo: RandomForestClassifier (sklearn).

Split: temporal ‚Äî 70% inicial para treino, 30% final para teste.

Sa√≠das:

assets/matriz_confusao_estado.png

assets/feature_importance_estado.png

src/machine_learning/models/modelo_estado_peca.joblib

### Como rodar:
```bash
python src/machine_learning/classificar_estado_peca.py

## 2) Previs√£o de falha (horizonte fixo)

Arquivo: prever_falha_proximas_24h.py

Objetivo: prever se haver√° falha para a mesma pe√ßa nas pr√≥ximas 24h (par√¢metro HORIZON_H).

R√≥tulo: fail_next_h (gerado a partir da coluna falha==1 no futuro da pe√ßa).

Features:

B√°sicas: tempo_uso, ciclos, temperatura, vibracao

De janela: m√©dias e desvios (3, 6, 12 janelas), varia√ß√µes de ciclos/tempo_uso

Modelo: GradientBoostingClassifier (sklearn).

Split: temporal ‚Äî 70% inicial treino, 30% final teste.

Sa√≠das:

assets/matriz_confusao_falha_24h.png

assets/roc_falha_24h.png

src/machine_learning/models/modelo_falha_24h.joblib

### Como rodar
```bash
python src/machine_learning/prever_falha_proximas_24h.py


##‚öôÔ∏è Par√¢metros e caminhos

Caminho do CSV: src/app/database/sensores.csv
(ajuste a constante CSV_PATH nos scripts, se necess√°rio).

Horizonte de previs√£o (falha): altere HORIZON_H = 24 para 12/48/etc.

Seed dos modelos: RANDOM_SEED = 42.


## üìä M√©tricas & Artefatos

Classifica√ß√£o de estado: relat√≥rio de classifica√ß√£o + matriz de confus√£o; gr√°fico de import√¢ncia de features para explicar o modelo.

Previs√£o de falha: relat√≥rio de classifica√ß√£o, ROC-AUC (quando poss√≠vel), matriz de confus√£o e curva ROC.

Gr√°ficos s√£o salvos em assets/. Modelos .joblib em src/machine_learning/models/.

## üß™ Reprodutibilidade

Garanta que sensores.csv est√° presente e com as colunas:

id_peca, leitura_data_hora, tempo_uso, ciclos, temperatura, vibracao, falha, risco_falha

Rode os dois scripts exatamente nas instru√ß√µes acima (seed fixa).

Resultados (m√©tricas/plots) ser√£o reprodut√≠veis para o mesmo CSV.

## üõ†Ô∏è Dicas & Troubleshooting

Classe rara (poucas falhas):

Aumente HORIZON_H (ex.: 48h) para ter mais positivos.

Use class_weight='balanced' (ou SMOTE) se necess√°rio.

Vazamento temporal: os splits j√° s√£o temporais. Evite embaralhar.

Colunas nulas: se temperatura/vibracao tiverem nulos, revise seu processo de consolida√ß√£o (√∫ltimo valor conhecido).

Ambiente sem GUI: o matplotlib salva imagens em arquivo; n√£o requer display.